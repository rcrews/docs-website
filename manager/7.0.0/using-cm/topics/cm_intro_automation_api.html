<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="copyright" content="(C) Copyright 2019"><meta name="DC.rights.owner" content="(C) Copyright 2019"><meta name="DC.Type" content="concept"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="xd_583c10bfdbd326ba--7f25092b-13fba2465e5--7f17"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.css"><link rel="stylesheet" href="/common/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css"><title>Using the Cloudera Manager API for Cluster Automation</title></head><body class="hg"><header class="chead"><div class="breadcrumbs">
<span class="bread-home"><a href="/"><i class="fas fa-home"></i><span class="text-home">Cloudera Docs</span></a></span>
<span class="bread-product"></span>
<span class="bread-version"></span>
<span class="bread-category">Category</span></div>
<div class="search"><i class="search-close fas fa-times"></i><input type="text" placeholder="Search Documentation"><i class="fas fa-search"></i></div><div class="launch-search"><i class="fas fa-search"></i></div><div class="launch-pubnav"><i class="fas fa-bars"></i></div></header><main class="cmain"><div class="cpage"><article class="maincontent"><div class="inner-breadcrumbs">Concepts</div><div id="content" aria-labelledby="ariaid-title1">
  <h1 class="title topictitle1" id="ariaid-title1">Using the Cloudera Manager API for Cluster Automation</h1>
  
  
  <div class="body conbody">
    
    <p class="p">One of the complexities of Apache Hadoop is the need to deploy clusters of
      servers, potentially on a regular basis. If you maintain hundreds of test
      and development clusters in different configurations, this process can be
      complex and cumbersome if not automated.</p>
  </div>
  <article class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_izs_5dz_zk">
    <h2 class="title topictitle2" id="ariaid-title2">Cluster Automation Use Cases</h2>
    
    <div class="body conbody">
      <p class="p">Cluster automation is useful in various situations. For example, you
        might work on many versions of CDH, which works on a wide variety of OS
        distributions (RHEL 6, Ubuntu Precise and Lucid, Debian Wheezy, and SLES
        11). You might have complex configuration combinations—highly available
        HDFS or simple HDFS, Kerberized or non-secure, YARN or MRv1, and so on.
        With these requirements, you need an easy way to create a new cluster
        that has the required setup. This cluster can also be used for
        integration, testing, customer support, demonstrations, and other
        purposes.</p>
      <p class="p">You can install and configure Hadoop according to precise specifications using
        the Cloudera Manager
        <a class="xref" href="http://cloudera.github.com/cm_api/" target="_blank">REST
        API</a>. Using the API, you can add hosts, install CDH, and define
        the cluster and its services. You can also tune heap sizes, set up HDFS
        HA, turn on Kerberos security and generate keytabs, and customize
        service directories and ports. Every configuration available in Cloudera
        Manager is exposed in the API.</p>
      <div class="p">The API also provides access to management functions:<ul class="ul" id="concept_izs_5dz_zk__ul_j52_gp3_kp">
          <li class="li">Obtaining logs and monitoring the system</li>
          <li class="li">Starting and stopping services</li>
          <li class="li">Polling cluster events</li>
          <li class="li">Creating a disaster recovery replication schedule</li>
        </ul>For example, you can use the API to retrieve logs from HDFS, HBase, or any other
        service, without knowing the log locations. You can also stop any
        service with no additional steps.</div>
      <p class="p">Use scenarios for the Cloudera Manager API for cluster automation might include:</p>
      <ul class="ul" id="concept_izs_5dz_zk__ul_w1t_5dz_zk">
        <li class="li">OEM and hardware partners that deliver Hadoop-in-a-box appliances using the API
          to set up CDH and Cloudera Manager on bare metal in the factory.</li>
        <li class="li">Automated deployment of new clusters, using a combination of Puppet and the
          Cloudera Manager API. Puppet does the OS-level provisioning and
          installs the software. The Cloudera Manager API sets up the Hadoop
          services and configures the cluster.</li>
        <li class="li">Integrating the API with reporting and alerting infrastructure. An external
          script can poll the API for health and metrics information, as well as
          the stream of events and alerts, to feed into a custom dashboard.</li>
      </ul>
    </div>
  </article>
  <article class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_y1t_5dz_zk">
    <h2 class="title topictitle2" id="ariaid-title3">Java API Example</h2>
    <div class="body conbody">
      <p class="p">This example covers the Java API client.</p>
      <p class="p">To use the Java client, add this dependency to your project's
        <span class="ph filepath">pom.xml</span>:</p>
<pre class="pre codeblock language-xml"><code>&lt;project&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;cdh.repo&lt;/id&gt;
      &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos&lt;/url&gt;
      &lt;name&gt;Cloudera Repository&lt;/name&gt;
    &lt;/repository&gt;
    …
  &lt;/repositories&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.cloudera.api&lt;/groupId&gt;
      &lt;artifactId&gt;cloudera-manager-api&lt;/artifactId&gt;
      &lt;version&gt;4.6.2&lt;/version&gt;      &lt;!-- Set to the version of Cloudera Manager you use --&gt;
    &lt;/dependency&gt;
    …
  &lt;/dependencies&gt;
  ...
&lt;/project&gt;</code></pre>
      <p class="p">The Java client works like a proxy. It hides from the caller any details about
        REST, HTTP, and JSON. The entry point is a handle to the root of the
        API:</p>
<pre class="pre codeblock language-java"><code>RootResource apiRoot = new ClouderaManagerClientBuilder().withHost("cm.cloudera.com")
.withUsernamePassword("admin", "admin").build().getRoot();</code></pre>
      <div class="p">From the root, you can traverse down to all other resources. (It's called "" because that is the current Cloudera Manager API version, but the same builder
        will also return a root from an earlier version of the API.) The tree
        view shows some key resources and supported operations:<ul class="ul" id="concept_y1t_5dz_zk__ul_ixn_nfz_zk">
          <li class="li"><code class="ph codeph">RootResource</code><ul class="ul" id="concept_y1t_5dz_zk__ul_sdf_ytf_1l">
              <li class="li"><code class="ph codeph">ClustersResource</code>
                - host membership, start cluster<ul class="ul" id="concept_y1t_5dz_zk__ul_asg_ztf_1l">
                  <li class="li"><code class="ph codeph">ServicesResource</code>
                    - configuration, get metrics, HA, service commands<ul class="ul" id="concept_y1t_5dz_zk__ul_ax5_d5f_1l">
                      <li class="li"><code class="ph codeph">RolesResource</code> - add roles, get metrics, logs</li>
                      <li class="li"><code class="ph codeph">RoleConfigGroupsResource</code> - configuration</li>
                    </ul></li>
                  <li class="li"><code class="ph codeph">ParcelsResource</code> - parcel management</li>
                </ul></li>
            </ul></li>
          <li class="li"><code class="ph codeph">HostsResource</code> - host management, get metrics</li>
          <li class="li"><code class="ph codeph">UsersResource</code> - user management</li>
        </ul></div>
      <p class="p">For more information, see the
        .</p>
      <p class="p">The following example lists and starts a cluster:</p>
<pre class="pre codeblock language-java"><code>// List of clusters
ApiClusterList clusters = apiRoot.getClustersResource().readClusters(DataView.SUMMARY);
for (ApiCluster cluster : clusters) {
  LOG.info("{}: {}", cluster.getName(), cluster.getVersion());
}

// Start the first cluster
ApiCommand cmd = apiRoot.getClustersResource().startCommand(clusters.get(0).getName());
while (cmd.isActive()) {
   Thread.sleep(100);
   cmd = apiRoot.getCommandsResource().readCommand(cmd.getId());
}
LOG.info("Cluster start {}", cmd.getSuccess() ? "succeeded" : "failed " + cmd.getResultMessage());</code></pre>
    </div>
  </article>
  <article class="topic concept nested1" aria-labelledby="ariaid-title4" id="concept_hlz_m5x_fz">
    <h2 class="title topictitle2" id="ariaid-title4">Python Example</h2>
    <div class="body conbody">
      <p class="p">You can see an example of automation with Python at the following link: <a class="xref" href="https://github.com/cloudera/cm_api/tree/master/python/examples/auto-deploy" target="_blank">Python example</a>. The example contains information on the
        requirements and steps to automate a cluster deployment.
      </p>
    </div>
  </article>
</div></article><div class="short-prev"><a href="">«</a></div><div class="short-next"><a href="">»</a></div><div class="up"></div><div class="prev"><a href="">« Getting Started with Apache Nifi</a></div><div class="next">Getting Started: <a href="">Terminology Used in This Guide »</a></div></div><aside class="pubmenu"><div class="product-title"><img class="product-logo" src="/common/img/smaller_icons/icon-hdf.png"><span class="product-name">Cloudera Data Platform</span></div><nav class="ctoc"></nav></aside></main><div class="logo"><a href="/"><img src="//www.cloudera.com/apps/settings/wcm/designs/www/clientlibs/css/assets/icons/favicon/apple-touch-icon-152x152.png"></a></div><nav class="product-drawer"><div class="full-logo"><img src="/common/img/cloudera.png"></div><ul class="products"><li class="cat">Data Platforms</li><li><img src="/common/img/mini_icons/icon-ambari.png"><span class="text">Ambari</span></li><li><img src="/common/img/mini_icons/icon-hdp.png"><span class="text">Data Platform</span></li><li class="active"><img src="/common/img/mini_icons/icon-hdf.png"><span class="text">Dataflow</span></li><li><img src="/common/img/mini_icons/icon-smartsense.png"><span class="text">Smartsense</span></li><li><img src="/common/img/mini_icons/icon-cybersecurity.png"><span class="text">Cybersecurity</span></li><li class="cat">Data Services</li><li><img src="/common/img/mini_icons/icon-dataplane.png"><span class="text">DataPlane Core</span></li><li><img src="/common/img/mini_icons/icon-studio.png"><span class="text">Data Analytics Studio</span></li><li><img src="/common/img/mini_icons/icon-datasteward.png"><span class="text">Data Steward Studio</span></li><li class="cat">Cloud Services</li><li><img src="/common/img/mini_icons/icon-cloudbreak.png"><span class="text">Cloudbreak</span></li><li><img src="/common/img/mini_icons/icon-hdcloud.png"><span class="text">HDCloud for AWS</span></li></ul><div class="open-close">»</div></nav><footer></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><script src="/common/js/main.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js" class="test"></script></body></html>