<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="DC.Type" content="task"><meta name="description" content="If you have legacy scripts that execute Hive queries from edge nodes using the Hive CLI, you must solve potential incompatibilities with variable substitution in these scripts. The Data Warehouse supports Beeline instead of Hive CLI. You can use Beeline to run legacy scripts with a few caveats."><meta name="DC.Relation" scheme="URI" content="../topics/cr-hive_run_hive_command.html"><meta name="prodname" content="Cloudera Runtime"><meta name="version" content="1"><meta name="release" content="0"><meta name="modification" content="0"><meta name="brand" content="Cloudera Runtime"><meta name="rights" content="© 2019 Cloudera, Inc."><meta name="DC.Date.Created" content="2019-04-15"><meta name="DC.Date.Modified" content="2019-04-15"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="cr-hive_use_variables"><link rel="stylesheet" type="text/css" href="../commonltr.css"><title>Convert Hive CLI scripts to Beeline</title><script type="application/javascript">
      
      
    //The id for tree cookie
    var treeCookieId = "treeview-bk_release-notes";
    var language = "en";
    var w = new Object();
    //Localization
    txt_filesfound = 'Results';
    txt_enter_at_least_1_char = "You must enter at least one character.";
    txt_browser_not_supported = "Please enable JavaScript.";
    txt_please_wait = "Please wait. Search in progress...";
    txt_results_for = "Results for: ";
    
    
    </script><script type="application/javascript" src="https://code.jquery.com/jquery-1.4.3.min.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/jquery-ui-1.8.2.custom.min.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/jquery.cookie.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/jquery.treeview.min.js"></script><link href="https://cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.css" rel="stylesheet" type="text/css" media="screen, projection"><script src="https://cdnjs.cloudflare.com/ajax/libs/qtip2/3.0.3/jquery.qtip.min.js" type="application/javascript"></script><script type="application/javascript" src="/common/js/navigation.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/main.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/htmlFileList.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/htmlFileInfoList.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/nwSearchFnt.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/en_stemmer.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/index-1.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/index-2.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/index-3.js"></script><script type="application/javascript">
      
      
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-22950817-19', 'auto');
    ga('send', 'pageview');
    
    
    </script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/plugins.js"></script><script type="application/javascript" src="/common/themes/pre-hdp-3.1/js/scripts.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js" type="application/javascript"></script><script type="application/javascript">
      
    // PAGE SPECIFIC SCRIPTS
    
    $('.chapters>li .dropdown').click(function () {
    var $arrow = $(this).find('i.fa');
    if( $arrow.hasClass('fa-chevron-down')) {
    $(this).siblings('.sections').show();
    $arrow.removeClass('fa-chevron-down').addClass('fa-chevron-up');
    } else {
    console.log('up');
    $(this).siblings('.sections').hide();
    $arrow.removeClass('fa-chevron-up').addClass('fa-chevron-down');
    }
    });
    
    //  $('h3').on('mouseenter',function() {
    //      console.log('received mouseover');
    //      $(this).find('.hash-link').show();
    //  });
    
    //  $('h3').on('mouseleave',function() {
    //      $(this).find('.hash-link').hide();
    //  });
    
    
    // STICKY SIDEBARs
    var stickySidebar = $('.sticky');
    
    if (stickySidebar.length > 0) {
    var stickyHeight = stickySidebar.height(),
    sidebarTop = stickySidebar.offset().top;
    }
    
    // on scroll move the sidebar
    $(window).scroll(function () {
    if (stickySidebar.length > 0) {
    var scrollTop = $(window).scrollTop();
    console.log
    
    if (sidebarTop < scrollTop) {
    stickySidebar.css('top', scrollTop - sidebarTop);
    
    // stop the sticky sidebar at the footer to avoid overlapping
    var sidebarBottom = stickySidebar.offset().top + stickyHeight,
    stickyStop = $('.main-content').offset().top + $('.main-content').height();
    if (stickyStop < sidebarBottom) {
    var stopPosition = $('.main-content').height() - stickyHeight;
    stickySidebar.css('top', stopPosition);
    }
    }
    else {
    stickySidebar.css('top', '0');
    }
    }
    });
    
    $(window).resize(function () {
    if (stickySidebar.length > 0) {
    stickyHeight = stickySidebar.height();
    }
    });
    
    // Initialize Syntax Highlighting
    hljs.initHighlightingOnLoad();
    
    </script><style type="text/css">
      
      
    input {
    margin-bottom: 5px;
    margin-top: 2px;
    }
    
    .folder {
    display: block;
    height: 22px;
    padding-left: 20px;
    background: transparent url(/common/themes/pre-hdp-3.1/images/folder.gif) 0 0px no-repeat;
    }
    
    </style><link href="/common/themes/pre-hdp-3.1/images/favicon.ico" rel="icon" type="image/x-icon" sizes="16x16"><link href="https://hortonworks.com/wp-content/uploads/2016/04/cropped-favicon521x512-70x70.png" rel="icon" type="image/x-icon" sizes="32x32"><link href="https://hortonworks.com/wp-content/uploads/2016/04/cropped-favicon521x512-300x300.png" rel="icon" type="image/x-icon" sizes="192x192"><link href="https://hortonworks.com/wp-content/uploads/2016/04/cropped-favicon521x512-300x300.png" rel="apple-touch-icon-precomposed" type="image/x-icon" sizes="192x192"><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css" rel="stylesheet"><link rel="stylesheet" media="screen, projection" href="/common/themes/pre-hdp-3.1/css/main.css"><link rel="stylesheet" media="screen, projection" href="/common/themes/pre-hdp-3.1/css/docux.css"><style type="text/css"></style><link rel="stylesheet" type="text/css" media="screen, projection" href="/common/themes/pre-hdp-3.1/css/jquery-ui-1.8.2.custom.css"><link rel="stylesheet" type="text/css" media="screen, projection" href="/common/themes/pre-hdp-3.1/css/jquery.treeview.css"><link href="https://cdn.jsdelivr.net/qtip2/3.0.3/jquery.qtip.min.css" rel="stylesheet" type="text/css" media="screen, projection"></head><body class="docs books"><div id="body_container"><div class="breadcrumb_bg"><!-- --></div><div id="navbar"><section class="ps topstrip"><div><!-- --></div></section></div><div id="mainbody"><section class="ps titlebar"><div><div class="breadcrumb"><a href="/">Hortonworks Docs</a> » <a id="index_page" href="../../index.html">Cloudera Runtime 1.0.0</a> » <span class="current_book">Start up and running Hive commands</span></div><div class="book_title">Start up and running Hive commands</div><div class="ebooks"><div class="formats"><span class="desc">Also available as:</span><div class="format"><a onclick="_gaq.push(['_trackEvent', 'Header', 'pdfDownload', 'click', 1]);" title="Download a PDF of this document" class="pdficon" href="../cr-hive_starting_hive.pdf"><img src="/common/themes/pre-hdp-3.1/images/pdf.png" alt="PDF"></a></div></div></div></div></section><div class="lowerbody"><section class="ps doc-content"><div><div class="aside left"><div><div id="leftnavigation" style="padding-top:3px; background-color:white;"><div class="ui-tabs ui-widget ui-widget-content ui-corner-all"><div id="treeDiv" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><img src="/common/themes/pre-hdp-3.1/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"><div id="ulTreeDiv" style="display:none" class="thisisthat"><ul id="tree" class="filetree"><li><a href="../topics/cr-hive_start_hive_as_authorized_user.html">Start the Hive Shell</a></li><li><a href="../topics/cr-hive_run_hive_command.html">Run a Hive command</a></li><li class="active"><a href="../topics/cr-hive_use_variables.html">Convert Hive CLI scripts to Beeline</a></li></ul></div></div></div></div></div><div class="formats"><div class="pdf"><!-- --></div></div></div><div class="next-prev-links"><span class="previouslink"><a class="link" href="../topics/cr-hive_run_hive_command.html" title="You can run most Hive commands that push configuration variables to Hive SQL scripts from the command line of a node in your cluster. The hive keyword, which launches Beeline in the background, precedes the command.">Prev</a></span></div><div id="content" aria-labelledby="ariaid-title1">
    <h1 class="title topictitle1" id="ariaid-title1">Convert Hive CLI scripts to Beeline</h1>
    
    <div class="body taskbody"><p class="shortdesc">If you have legacy scripts that execute Hive queries from edge nodes using the Hive
        CLI, you must solve potential incompatibilities with variable substitution in these scripts.
        The Data Warehouse supports Beeline instead of Hive CLI. You can use Beeline to run legacy
        scripts with a few caveats.</p>
        <section class="section context">
            <p class="p">In this task, you resolve incompatibilities in legacy Hive CLI scripts and
                Beeline:</p>
            <ul class="ul" id="cr-hive_use_variables__ul_j4m_fls_vhb">
                <li class="li">Configuration variables
                    <ul class="ul" id="cr-hive_use_variables__ul_tgv_2s2_whb">
                        <li class="li">Problem: You cannot refer to configuration parameters in scripts using
                            the <code class="ph codeph">hiveconf</code> namespace unless allowed.</li>
                        <li class="li">Solution: You include the parameter in the HiveServer whitelist.</li>
                    </ul>
                </li>
                <li class="li">Namespace problems<ul class="ul" id="cr-hive_use_variables__ul_fnc_ks2_whb">
                    <li class="li">Problem: Beeline does not support the
                        <code class="ph codeph">system</code> and <code class="ph codeph">env</code> namespaces for
                        variables.</li>
                    <li class="li">Solution: You remove these namespace references from scripts using a
                        conversion technique described in this task.</li>
                </ul></li>
            </ul>
        </section>
        <ol class="ol steps"><li class="li step stepexpand">
                <span class="ph cmd">Create a conversion script named <code class="ph codeph">env_to_hivevar.sh</code> that
                    removes <code class="ph codeph">env</code> references in your SQL scripts.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>#!/usr/bin/env bash
                        
CMD_LINE=""
                        
#Blank conversion of all env scoped values
for I in `env`; do
  CMD_LINE="$CMD_LINE --hivevar env:${I} "
done
echo ${CMD_LINE}</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">On the command line of a node in your cluster, define and export a variable
                    named HIVEVAR, for example, and set it to execute the conversion script.</span>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>export HIVEVAR=`./env_to_hivevar.sh`</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Define and export variables to hold a few variables for testing the
                    conversion.</span>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>export LOC_TIME_ZONE="US/EASTERN"
export MY_TEST_VAR="TODAY"</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">On the command line of a cluster node, test the conversion: Execute a command
                    that references HIVEVAR to parse a SQL statement, remove the incompatible
                    <code class="ph codeph">env</code> namespace, and execute the remaining SQL. </span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>hive ${HIVEVAR} -e 'select "${env:LOC_TIME_ZONE}";'</code></pre>
                </div>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>+-------------+
|     _c0     |
+-------------+
| US/EASTERN  |
+-------------+</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Create a text file named <code class="ph codeph">init_var.sql</code> to simulate a legacy
                    script that sets two configuration parameters, one in the problematic
                    <code class="ph codeph">env</code> namespace.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>set mylocal.test.var=hello;
set mylocal.test.env.var=${env:MY_TEST_VAR};</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Whitelist these configuration parameters: In Ambari, go to Hive &gt; Configs &gt;
                    Advanced &gt; Custom hiveserver2-site.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Add the property key:
                    <code class="ph codeph">hive.security.authorization.sqlstd.confwhitelist.append</code>.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Provide the property value, or values, to whitelist, for example:
                    <code class="ph codeph">mylocal\..*|junk</code>.</span>
                <div class="itemgroup info">This action appends <code class="ph codeph">mylocal.test.var</code> and
                    <code class="ph codeph">mylocal.test.env.var</code> parameters to the whitelist.</div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Save configuration changes, and restart any components as required.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Execute a command that references HIVEVAR to parse a SQL script, removes the
                    incompatible <code class="ph codeph">env</code> namespace, and executes the remaining SQL,
                    including the whitelisted configuration parameters identified by
                    <code class="ph codeph">hiveconf:</code>.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>hive -i init_var.sql ${HIVEVAR} -e 'select "${hiveconf:mylocal.test.var}","${hiveconf:mylocal.test.env.var}";'                  </code></pre>
                </div>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>+--------+--------+
|  _c0   |  _c1   |
+--------+--------+
| hello  | TODAY  |
+--------+--------+</code></pre>
                </div>
            </li></ol>
    </div>
<nav role="navigation" class="related-links"><div class="familylinks"></div></nav></div></div></section></div></div></div><section class="ps footer"><div><div class="copyright">© 2012–2019, Hortonworks, Inc.</div><div class="license">Document licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">Creative
          Commons Attribution ShareAlike 4.0 License</a>.</div><div class="menulinks"><a href="https://hortonworks.com">Hortonworks.com</a> | 
          <a href="#">Documentation</a> |
          <a href="https://hortonworks.com/support/">Support</a> |
          <a href="https://community.hortonworks.com/">Community</a></div></div></section></body></html>