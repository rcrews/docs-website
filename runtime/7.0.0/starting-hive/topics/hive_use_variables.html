<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="DC.Type" content="task"><meta name="description" content="If you have legacy scripts that execute Hive queries from edge nodes using the Hive CLI, you must solve potential incompatibilities with variable substitution in these scripts. The Data Warehouse supports Beeline instead of Hive CLI. You can use Beeline to run legacy scripts with a few caveats."><meta name="DC.Relation" scheme="URI" content="../topics/hive_run_hive_command.html"><meta name="prodname" content="Cloudera Runtime"><meta name="version" content="1"><meta name="release" content="0"><meta name="modification" content="0"><meta name="brand" content="Cloudera Runtime"><meta name="rights" content="© 2019 Cloudera, Inc."><meta name="DC.Date.Created" content="2019-04-15"><meta name="DC.Date.Modified" content="2019-04-15"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="hive_use_variables"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.css"><link rel="stylesheet" href="/common/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css"><title>Convert Hive CLI scripts to Beeline</title></head><body class="hg"><header class="chead"><div class="breadcrumbs">
<span class="bread-home"><a href="/"><i class="fas fa-home"></i><span class="text-home">Cloudera Docs</span></a></span>
<span class="bread-product"></span>
<span class="bread-version"></span>
<span class="bread-category">Category</span></div>
<div class="search"><i class="search-close fas fa-times"></i><input type="text" placeholder="Search Documentation"><i class="fas fa-search"></i></div><div class="launch-search"><i class="fas fa-search"></i></div><div class="launch-pubnav"><i class="fas fa-bars"></i></div></header><main class="cmain"><div class="cpage"><article class="maincontent"><div class="inner-breadcrumbs">Concepts</div><div id="content" aria-labelledby="ariaid-title1">
    <h1 class="title topictitle1" id="ariaid-title1">Convert Hive CLI scripts to Beeline</h1>
    
    <div class="body taskbody"><p class="shortdesc">If you have legacy scripts that execute Hive queries from edge nodes using the Hive
        CLI, you must solve potential incompatibilities with variable substitution in these scripts.
        The Data Warehouse supports Beeline instead of Hive CLI. You can use Beeline to run legacy
        scripts with a few caveats.</p>
        <section class="section context">
            <p class="p">In this task, you resolve incompatibilities in legacy Hive CLI scripts and
                Beeline:</p>
            <ul class="ul" id="hive_use_variables__ul_j4m_fls_vhb">
                <li class="li">Configuration variables
                    <ul class="ul" id="hive_use_variables__ul_tgv_2s2_whb">
                        <li class="li">Problem: You cannot refer to configuration parameters in scripts using
                            the <code class="ph codeph">hiveconf</code> namespace unless allowed.</li>
                        <li class="li">Solution: You include the parameter in the HiveServer whitelist.</li>
                    </ul>
                </li>
                <li class="li">Namespace problems<ul class="ul" id="hive_use_variables__ul_fnc_ks2_whb">
                    <li class="li">Problem: Beeline does not support the
                        <code class="ph codeph">system</code> and <code class="ph codeph">env</code> namespaces for
                        variables.</li>
                    <li class="li">Solution: You remove these namespace references from scripts using a
                        conversion technique described in this task.</li>
                </ul></li>
            </ul>
        </section>
        <ol class="ol steps"><li class="li step stepexpand">
                <span class="ph cmd">Create a conversion script named <code class="ph codeph">env_to_hivevar.sh</code> that
                    removes <code class="ph codeph">env</code> references in your SQL scripts.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>#!/usr/bin/env bash
                        
CMD_LINE=""
                        
#Blank conversion of all env scoped values
for I in `env`; do
  CMD_LINE="$CMD_LINE --hivevar env:${I} "
done
echo ${CMD_LINE}</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">On the command line of a node in your cluster, define and export a variable
                    named HIVEVAR, for example, and set it to execute the conversion script.</span>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>export HIVEVAR=`./env_to_hivevar.sh`</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Define and export variables to hold a few variables for testing the
                    conversion.</span>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>export LOC_TIME_ZONE="US/EASTERN"
export MY_TEST_VAR="TODAY"</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">On the command line of a cluster node, test the conversion: Execute a command
                    that references HIVEVAR to parse a SQL statement, remove the incompatible
                    <code class="ph codeph">env</code> namespace, and execute the remaining SQL. </span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>hive ${HIVEVAR} -e 'select "${env:LOC_TIME_ZONE}";'</code></pre>
                </div>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>+-------------+
|     _c0     |
+-------------+
| US/EASTERN  |
+-------------+</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Create a text file named <code class="ph codeph">init_var.sql</code> to simulate a legacy
                    script that sets two configuration parameters, one in the problematic
                    <code class="ph codeph">env</code> namespace.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>set mylocal.test.var=hello;
set mylocal.test.env.var=${env:MY_TEST_VAR};</code></pre>
                </div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Whitelist these configuration parameters: In Ambari, go to Hive &gt; Configs &gt;
                    Advanced &gt; Custom hiveserver2-site.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Add the property key:
                    <code class="ph codeph">hive.security.authorization.sqlstd.confwhitelist.append</code>.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Provide the property value, or values, to whitelist, for example:
                    <code class="ph codeph">mylocal\..*|junk</code>.</span>
                <div class="itemgroup info">This action appends <code class="ph codeph">mylocal.test.var</code> and
                    <code class="ph codeph">mylocal.test.env.var</code> parameters to the whitelist.</div>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Save configuration changes, and restart any components as required.</span>
            </li><li class="li step stepexpand">
                <span class="ph cmd">Execute a command that references HIVEVAR to parse a SQL script, removes the
                    incompatible <code class="ph codeph">env</code> namespace, and executes the remaining SQL,
                    including the whitelisted configuration parameters identified by
                    <code class="ph codeph">hiveconf:</code>.</span>
                <div class="itemgroup stepxmp">
                    <pre class="pre codeblock"><code>hive -i init_var.sql ${HIVEVAR} -e 'select "${hiveconf:mylocal.test.var}","${hiveconf:mylocal.test.env.var}";'                  </code></pre>
                </div>
                <div class="itemgroup stepresult">
                    <pre class="pre codeblock"><code>+--------+--------+
|  _c0   |  _c1   |
+--------+--------+
| hello  | TODAY  |
+--------+--------+</code></pre>
                </div>
            </li></ol>
    </div>
<nav role="navigation" class="related-links"><div class="familylinks"></div></nav></div></article><div class="short-prev"><a href="">«</a></div><div class="short-next"><a href="">»</a></div><div class="up"></div><div class="prev"><a href="">« Getting Started with Apache Nifi</a></div><div class="next">Getting Started: <a href="">Terminology Used in This Guide »</a></div></div><aside class="pubmenu"><div class="product-title"><img class="product-logo" src="/common/img/smaller_icons/icon-hdf.png"><span class="product-name">Cloudera Data Platform</span></div><nav class="ctoc"></nav></aside></main><div class="logo"><a href="/"><img src="//www.cloudera.com/apps/settings/wcm/designs/www/clientlibs/css/assets/icons/favicon/apple-touch-icon-152x152.png"></a></div><nav class="product-drawer"><div class="full-logo"><img src="/common/img/cloudera.png"></div><ul class="products"><li class="cat">Data Platforms</li><li><img src="/common/img/mini_icons/icon-ambari.png"><span class="text">Ambari</span></li><li><img src="/common/img/mini_icons/icon-hdp.png"><span class="text">Data Platform</span></li><li class="active"><img src="/common/img/mini_icons/icon-hdf.png"><span class="text">Dataflow</span></li><li><img src="/common/img/mini_icons/icon-smartsense.png"><span class="text">Smartsense</span></li><li><img src="/common/img/mini_icons/icon-cybersecurity.png"><span class="text">Cybersecurity</span></li><li class="cat">Data Services</li><li><img src="/common/img/mini_icons/icon-dataplane.png"><span class="text">DataPlane Core</span></li><li><img src="/common/img/mini_icons/icon-studio.png"><span class="text">Data Analytics Studio</span></li><li><img src="/common/img/mini_icons/icon-datasteward.png"><span class="text">Data Steward Studio</span></li><li class="cat">Cloud Services</li><li><img src="/common/img/mini_icons/icon-cloudbreak.png"><span class="text">Cloudbreak</span></li><li><img src="/common/img/mini_icons/icon-hdcloud.png"><span class="text">HDCloud for AWS</span></li></ul><div class="open-close">»</div></nav><footer></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><script src="/common/js/main.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js" class="test"></script></body></html>